<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>菜单管理--后台管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="/css/public.css" media="all" />
    <link rel="stylesheet" href="/css/common.css" media="all" />
    <link rel="stylesheet" href="/zTree_v3/css/zTreeStyle/zTreeStyle.css" media="all">
</head>

<body>
<div id="deptForm" class="layui-fluid">
    <div class="zTreeDemoBackground left">
        <ul id="treeDemo" class="ztree"></ul>
    </div>
    <div class="layui-row" style="background: #CFD4D5;padding: 10px;">
        <div style="text-align: center;">
            <button class="layui-btn layui-btn-sm" id="saveButton">保存</button>
            <button class="layui-btn layui-btn-sm layui-btn-primary" type="button" onclick="cancels()">取消</button>
        </div>
    </div>
</div>
</body>


<script type="text/javascript" src="/layui/layui.js"></script>
<script type="text/javascript" src="/zTree_v3/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="/zTree_v3/js/jquery.ztree.all.min.js"></script>
<script type="text/javascript">
    var zNodes = "";
    $(function () {
        var setting = {
            view: {
                dblClickExpand: false,//双击节点时，是否自动展开父节点的标识
                showLine: true,//是否显示节点之间的连线
                fontCss:{'color':'black'},//字体样式函数
                selectedMulti: false //设置是否允许同时选中多个节点
            },
            data: {
                key : {
                  name:"resName"
                },
                simpleData: {//简单数据模式
                    enable:true,
                    idKey: "resCode",
                    pIdKey: "resPcode",
                    rootPId: "-1"
                }
            },
            callback: {
                onClick:zTreeBeforeExpand
            }
        };
        $.ajax({
            url:"/system/res/getResourceList",
            type:"get",
            dataType:"json",
            success:function(data){
                zNodes=data.data;
                zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, data.data);//初始化操作
                zTreeObj.expandAll(true);
            }
        });
    });
    var ZTreeDlg = {
        index: parent.layer.getFrameIndex(window.name),
        tempName: "",
        tempId: ""
    };

    $("#saveButton").bind("click", function () {
        parent.MenuInfoDlg.data.pcodeName = ZTreeDlg.tempName;
        parent.MenuInfoDlg.data.pid = ZTreeDlg.tempId;
        parent.layer.close(ZTreeDlg.index);
    });
    function zTreeBeforeExpand(e, treeId, zNodes) {
        ZTreeDlg.tempId = zNodes.resCode;
        var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
        var nodes = treeObj.getSelectedNodes();
        ZTreeDlg.tempName = nodes[0].resName;
    }
</script>

</body>

</html>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hna.hka.archive.management.assetsSystem.dao.RealTimeMapper">

    <select id="line" resultType="java.util.HashMap">
        select REAL_TIME, sum(JXZ) as jxz, sum(DRYS) as drys
        from SYS_ORDER_REALTIME
                 left join SYS_SCENIC_SPOT on SPOT_ID = SCENIC_SPOT_ID
        WHERE SUBSTR(REAL_TIME , 12 , 5) BETWEEN '08:00' and '23:00'
        <if test="_parameter != null">
            and SPOT_ID = #{_parameter}
        </if>
        group BY REAL_TIME
        ORDER by REAL_TIME
    </select>


    <select id="lineDRYS" resultType="java.lang.Double">
        select sum(DRYS) as drys
        from SYS_ORDER_REALTIME
        left join SYS_SCENIC_SPOT on SPOT_ID = SCENIC_SPOT_ID
        WHERE SUBSTR(REAL_TIME , 12 , 5) BETWEEN '08:00' and '23:00'
        <if test="spotId != null and spotId != ''">
            and SPOT_ID = #{spotId}
        </if>
        <if test="time != null">
            and REAL_TIME like CONCAT(#{time},'%')
        </if>
        group BY REAL_TIME
        ORDER by REAL_TIME
    </select>

    <select id="lineJXZ" resultType="java.lang.Integer">
        select sum(JXZ) as jxz
        from SYS_ORDER_REALTIME
        left join SYS_SCENIC_SPOT on SPOT_ID = SCENIC_SPOT_ID
        WHERE SUBSTR(REAL_TIME , 12 , 5) BETWEEN '08:00' and '23:00'
        <if test="spotId != null">
            and SPOT_ID = #{spotId}
        </if>
        <if test="time != null">
            and REAL_TIME like CONCAT(#{time},'%')
        </if>
        group BY REAL_TIME
        ORDER by REAL_TIME
    </select>

    <select id="lineDate" resultType="java.lang.String">
        select  SUBSTR(REAL_TIME , 12 , 5)
        from SYS_ORDER_REALTIME
        left join SYS_SCENIC_SPOT on SPOT_ID = SCENIC_SPOT_ID
        WHERE SUBSTR(REAL_TIME , 12 , 5) BETWEEN '08:00' and '23:00'
        <if test="time != null">
            and REAL_TIME like CONCAT(#{time},'%')
        </if>
        group BY REAL_TIME
        ORDER by REAL_TIME
    </select>


    <select id="hourMinuteAndSecond" resultType="java.lang.String">
        select SUBSTR(REAL_TIME,12,16)
        from SYS_ORDER_REALTIME
        left join SYS_SCENIC_SPOT on SPOT_ID = SCENIC_SPOT_ID
        WHERE SUBSTR(REAL_TIME , 12 , 5) BETWEEN '08:00' and '23:00'
        and REAL_TIME like CONCAT(SUBSTR(date_sub(curdate(),interval 1 day),1,10),"%")
        group BY SUBSTR(REAL_TIME,12,16)
        ORDER by REAL_TIME
    </select>

    <insert id="insert" parameterType="com.hna.hka.archive.management.system.model.SysOrderRealTime">
        insert into SYS_ORDER_REALTIME
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="realTime != null" >
                REAL_TIME,
            </if>
            <if test="spotId != null" >
                SPOT_ID,
            </if>
            <if test="jxz != null" >
                JXZ,
            </if>
            <if test="drys != null" >
                DRYS,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="realTime != null" >
                #{realTime,jdbcType=VARCHAR},
            </if>
            <if test="spotId != null" >
                #{spotId,jdbcType=BIGINT},
            </if>
            <if test="jxz != null" >
                #{jxz,jdbcType=INTEGER},
            </if>
            <if test="drys != null" >
                #{drys,jdbcType=DECIMAL},
            </if>
        </trim>

    </insert>
</mapper>
